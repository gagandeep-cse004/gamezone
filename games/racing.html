<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Racing - GameZone</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Play Racing online for free. Classic arcade racing game with endless mode and power-ups!">
    <meta name="keywords" content="racing game, arcade game, car game, free games, endless runner">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #0a0a1a;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 107, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 100%, rgba(0, 212, 255, 0.08) 0%, transparent 50%);
            animation: backgroundPulse 10s ease infinite;
            z-index: -1;
        }

        @keyframes backgroundPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Scanlines effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg,
                    rgba(0, 0, 0, 0.1) 0px,
                    rgba(0, 0, 0, 0.1) 1px,
                    transparent 1px,
                    transparent 2px);
            pointer-events: none;
            z-index: 1000;
            opacity: 0.3;
        }

        /* ========== NAVBAR ========== */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1001;
            background: rgba(10, 10, 26, 0.98);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 107, 0, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo i {
            font-size: 2rem;
            color: #ff6b00;
        }

        .logo span {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ff6b00, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }

        .nav-links a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            color: #ff6b00;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 107, 0, 0.3);
            border-radius: 50px;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #ff6b00;
            border-color: #ff6b00;
            color: #0a0a1a;
        }

        .menu-toggle {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #fff;
        }

        /* ========== GAME CONTAINER ========== */
        .game-page {
            padding: 100px 20px 40px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-header h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff6b00, #ff0080, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 107, 0, 0.5);
            animation: neonFlicker 2s ease-in-out infinite;
        }

        @keyframes neonFlicker {

            0%,
            100% {
                opacity: 1;
            }

            92% {
                opacity: 1;
            }

            93% {
                opacity: 0.8;
            }

            94% {
                opacity: 1;
            }

            95% {
                opacity: 0.9;
            }

            96% {
                opacity: 1;
            }
        }

        .game-header p {
            color: #888;
            font-size: 1rem;
        }

        /* Stats Display */
        .stats-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            text-align: center;
            padding: 15px 25px;
            background: rgba(255, 107, 0, 0.1);
            border: 2px solid rgba(255, 107, 0, 0.3);
            border-radius: 15px;
            min-width: 100px;
        }

        .stat-box.speed {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.3);
        }

        .stat-box.distance {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
        }

        .stat-box.lives {
            background: rgba(255, 0, 128, 0.1);
            border-color: rgba(255, 0, 128, 0.3);
        }

        .stat-box h3 {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .stat-box.score h3 {
            color: #ff6b00;
            text-shadow: 0 0 20px rgba(255, 107, 0, 0.5);
        }

        .stat-box.speed h3 {
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .stat-box.distance h3 {
            color: #00ff88;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .stat-box.lives h3 {
            color: #ff0080;
            text-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
        }

        .stat-box p {
            font-size: 0.85rem;
            color: #888;
        }

        /* Game Wrapper */
        .game-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Canvas Container */
        .canvas-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            box-shadow:
                0 0 50px rgba(255, 107, 0, 0.2),
                0 0 100px rgba(255, 0, 128, 0.1),
                inset 0 0 50px rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(255, 107, 0, 0.3);
        }

        #gameCanvas {
            display: block;
            background: #1a1a2e;
        }

        /* Power-up Indicators */
        .powerup-indicators {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }

        .powerup-indicator {
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            font-size: 0.8rem;
            display: none;
            align-items: center;
            gap: 5px;
            animation: powerupPulse 1s ease infinite;
            border: 2px solid #ff6b00;
        }

        .powerup-indicator.active {
            display: flex;
        }

        @keyframes powerupPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        /* Game Overlays */
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .game-overlay.hidden {
            display: none;
        }

        .overlay-content {
            text-align: center;
            padding: 30px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .overlay-content h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 2rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ff6b00, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .overlay-content .icon-preview {
            font-size: 4rem;
            margin: 20px 0;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        /* Car Selection */
        .car-selector {
            margin: 20px 0;
        }

        .car-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .car-option {
            width: 80px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .car-option:hover {
            transform: translateY(-3px);
            border-color: #ff6b00;
        }

        .car-option.selected {
            background: rgba(255, 107, 0, 0.2);
            border-color: #ff6b00;
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.3);
        }

        .car-option .car-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }

        .car-option span {
            font-size: 0.7rem;
            color: #888;
        }

        /* Difficulty Selection */
        .difficulty-selector {
            margin: 20px 0;
        }

        .difficulty-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .diff-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }

        .diff-btn:hover {
            transform: translateY(-2px);
        }

        .diff-btn.easy:hover,
        .diff-btn.easy.selected {
            background: #2ecc71;
            border-color: #2ecc71;
        }

        .diff-btn.medium:hover,
        .diff-btn.medium.selected {
            background: #f39c12;
            border-color: #f39c12;
        }

        .diff-btn.hard:hover,
        .diff-btn.hard.selected {
            background: #e74c3c;
            border-color: #e74c3c;
        }

        .diff-btn.insane:hover,
        .diff-btn.insane.selected {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border-color: #9b59b6;
        }

        /* Game Buttons */
        .game-btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            margin: 5px;
            position: relative;
            overflow: hidden;
        }

        .btn-play {
            background: linear-gradient(135deg, #ff6b00, #ff0080);
            color: #fff;
        }

        .btn-play:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 107, 0, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Game Over Display */
        .gameover-stats {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }

        .gameover-stats .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gameover-stats .stat-row:last-child {
            border-bottom: none;
        }

        .gameover-stats .stat-label {
            color: #888;
        }

        .gameover-stats .stat-value {
            font-weight: 700;
            color: #ff6b00;
        }

        .new-record {
            color: #00ff88 !important;
            animation: pulse 0.5s ease infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Controls Info */
        .controls-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-group {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            min-width: 120px;
        }

        .control-group h4 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: #ff6b00;
        }

        .key-display {
            display: flex;
            gap: 5px;
            align-items: center;
            justify-content: center;
        }

        .key {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Game Controls */
        .game-controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 107, 0, 0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .control-btn:hover {
            background: #ff6b00;
            border-color: #ff6b00;
            color: #fff;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        .mobile-btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 107, 0, 0.5);
            border-radius: 15px;
            color: #fff;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mobile-btn:active {
            transform: scale(0.95);
            background: rgba(255, 107, 0, 0.3);
        }

        /* Instructions */
        .game-instructions {
            margin-top: 30px;
            max-width: 700px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px 35px;
            border: 1px solid rgba(255, 107, 0, 0.2);
        }

        .game-instructions h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ff6b00, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .instruction-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .instruction-item i {
            font-size: 1.5rem;
            color: #ff6b00;
            width: 30px;
        }

        .instruction-item span {
            color: #aaa;
            font-size: 0.9rem;
        }

        /* Power-ups Legend */
        .powerups-legend {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .powerups-legend h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #ff0080;
        }

        .powerup-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .powerup-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .powerup-item .icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .powerup-item span {
            color: #aaa;
            font-size: 0.85rem;
        }

        /* Tips */
        .tips-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 107, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 0, 0.2);
        }

        .tips-section h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #ff6b00;
        }

        .tips-section ul {
            list-style: none;
            color: #aaa;
            font-size: 0.85rem;
        }

        .tips-section li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tips-section li i {
            color: #ff6b00;
        }

        /* Footer */
        .game-footer {
            margin-top: 50px;
            text-align: center;
            padding: 20px;
            border-top: 1px solid rgba(255, 107, 0, 0.2);
            width: 100%;
            max-width: 800px;
        }

        .game-footer p {
            color: #666;
            font-size: 0.9rem;
        }

        .game-footer a {
            color: #ff6b00;
            text-decoration: none;
        }

        /* Sound toggle */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 107, 0, 0.3);
            border-radius: 50%;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .sound-toggle:hover {
            background: #ff6b00;
            color: #fff;
        }

        /* Speed Lines */
        .speed-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .speed-lines.active {
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 15px 20px;
            }

            .nav-links {
                display: none;
            }

            .menu-toggle {
                display: block;
            }

            .game-header h1 {
                font-size: 1.5rem;
            }

            #gameCanvas {
                max-width: 100%;
                height: auto;
            }

            .stats-display {
                gap: 10px;
            }

            .stat-box {
                padding: 10px 15px;
                min-width: 80px;
            }

            .stat-box h3 {
                font-size: 1.2rem;
            }

            .mobile-controls {
                display: flex;
            }

            .game-instructions {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .game-header h1 {
                font-size: 1.2rem;
            }

            .stat-box h3 {
                font-size: 1rem;
            }

            .overlay-content h2 {
                font-size: 1.3rem;
            }

            .car-option {
                width: 65px;
                height: 85px;
            }

            .car-option .car-icon {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>

    <!-- ========== NAVBAR ========== -->
    <nav class="navbar">
        <a href="../index.html" class="logo">
            <i class="fas fa-gamepad"></i>
            <span>GameZone</span>
        </a>

        <ul class="nav-links">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../games.html">Games</a></li>
            <li><a href="../categories.html">Categories</a></li>
            <li><a href="../leaderboard.html">Leaderboard</a></li>
        </ul>

        <a href="../games.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            All Games
        </a>

        <div class="menu-toggle" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </div>
    </nav>

    <!-- ========== GAME PAGE ========== -->
    <main class="game-page">

        <div class="game-header">
            <h1>üèéÔ∏è TURBO RACING</h1>
            <p>Dodge traffic, collect power-ups, and race to the highest score!</p>
        </div>

        <!-- Stats Display -->
        <div class="stats-display">
            <div class="stat-box score">
                <h3 id="scoreDisplay">0</h3>
                <p>Score</p>
            </div>
            <div class="stat-box speed">
                <h3 id="speedDisplay">60</h3>
                <p>km/h</p>
            </div>
            <div class="stat-box distance">
                <h3 id="distanceDisplay">0</h3>
                <p>Distance (m)</p>
            </div>
            <div class="stat-box lives">
                <h3 id="livesDisplay">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</h3>
                <p>Lives</p>
            </div>
        </div>

        <!-- Game Wrapper -->
        <div class="game-wrapper">
            <div class="canvas-container">
                <canvas id="gameCanvas" width="500" height="700"></canvas>

                <!-- Power-up Indicators -->
                <div class="powerup-indicators">
                    <div class="powerup-indicator" id="shieldIndicator">
                        <span>üõ°Ô∏è</span>
                        <span id="shieldTime">5s</span>
                    </div>
                    <div class="powerup-indicator" id="magnetIndicator">
                        <span>üß≤</span>
                        <span id="magnetTime">5s</span>
                    </div>
                    <div class="powerup-indicator" id="slowmoIndicator">
                        <span>‚è±Ô∏è</span>
                        <span id="slowmoTime">5s</span>
                    </div>
                </div>

                <!-- Start Overlay -->
                <div class="game-overlay" id="startOverlay">
                    <div class="overlay-content">
                        <h2>üèéÔ∏è TURBO RACING</h2>
                        <div class="icon-preview">üöó</div>

                        <div class="car-selector">
                            <h3 style="font-size: 1rem; color: #888; margin-bottom: 15px;">Select Your Car</h3>
                            <div class="car-options">
                                <div class="car-option selected" onclick="selectCar(0)">
                                    <span class="car-icon">üöó</span>
                                    <span>Classic</span>
                                </div>
                                <div class="car-option" onclick="selectCar(1)">
                                    <span class="car-icon">üèéÔ∏è</span>
                                    <span>Racer</span>
                                </div>
                                <div class="car-option" onclick="selectCar(2)">
                                    <span class="car-icon">üöô</span>
                                    <span>SUV</span>
                                </div>
                                <div class="car-option" onclick="selectCar(3)">
                                    <span class="car-icon">üöï</span>
                                    <span>Taxi</span>
                                </div>
                                <div class="car-option" onclick="selectCar(4)">
                                    <span class="car-icon">üèçÔ∏è</span>
                                    <span>Bike</span>
                                </div>
                            </div>
                        </div>

                        <div class="difficulty-selector">
                            <h3 style="font-size: 1rem; color: #888; margin-bottom: 10px;">Difficulty</h3>
                            <div class="difficulty-buttons">
                                <button class="diff-btn easy" onclick="setDifficulty('easy')">Easy</button>
                                <button class="diff-btn medium selected"
                                    onclick="setDifficulty('medium')">Medium</button>
                                <button class="diff-btn hard" onclick="setDifficulty('hard')">Hard</button>
                                <button class="diff-btn insane" onclick="setDifficulty('insane')">Insane</button>
                            </div>
                        </div>

                        <div class="controls-info">
                            <div class="control-group">
                                <h4>Move</h4>
                                <div class="key-display">
                                    <span class="key">‚Üê</span>
                                    <span class="key">‚Üí</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <h4>Or</h4>
                                <div class="key-display">
                                    <span class="key">A</span>
                                    <span class="key">D</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <h4>Pause</h4>
                                <div class="key-display">
                                    <span class="key">P</span>
                                </div>
                            </div>
                        </div>

                        <button class="game-btn btn-play" onclick="startGame()">
                            <i class="fas fa-play"></i> Start Race
                        </button>
                    </div>
                </div>

                <!-- Pause Overlay -->
                <div class="game-overlay hidden" id="pauseOverlay">
                    <div class="overlay-content">
                        <h2>‚è∏Ô∏è PAUSED</h2>
                        <p style="color: #888; margin: 20px 0;">Press P or SPACE to continue</p>
                        <button class="game-btn btn-play" onclick="resumeGame()">
                            <i class="fas fa-play"></i> Resume
                        </button>
                        <button class="game-btn btn-secondary" onclick="restartGame()">
                            <i class="fas fa-redo"></i> Restart
                        </button>
                    </div>
                </div>

                <!-- Game Over Overlay -->
                <div class="game-overlay hidden" id="gameOverOverlay">
                    <div class="overlay-content">
                        <h2>üí• GAME OVER</h2>

                        <div class="gameover-stats">
                            <div class="stat-row">
                                <span class="stat-label">Final Score</span>
                                <span class="stat-value" id="finalScore">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Distance</span>
                                <span class="stat-value" id="finalDistance">0m</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Max Speed</span>
                                <span class="stat-value" id="finalMaxSpeed">0 km/h</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Cars Dodged</span>
                                <span class="stat-value" id="finalCarsDodged">0</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">High Score</span>
                                <span class="stat-value" id="highScoreDisplay">0</span>
                            </div>
                        </div>

                        <button class="game-btn btn-play" onclick="restartGame()">
                            <i class="fas fa-redo"></i> Play Again
                        </button>
                        <button class="game-btn btn-secondary" onclick="showMenu()">
                            <i class="fas fa-cog"></i> Main Menu
                        </button>
                    </div>
                </div>

                <!-- Countdown Overlay -->
                <div class="game-overlay hidden" id="countdownOverlay">
                    <div class="overlay-content">
                        <h2 id="countdownText" style="font-size: 5rem;">3</h2>
                    </div>
                </div>
            </div>

            <!-- Game Controls -->
            <div class="game-controls">
                <button class="control-btn" onclick="togglePause()" title="Pause (P)">
                    <i class="fas fa-pause" id="pauseIcon"></i>
                </button>
                <button class="control-btn" onclick="restartGame()" title="Restart">
                    <i class="fas fa-redo"></i>
                </button>
                <button class="control-btn" onclick="showMenu()" title="Menu">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="control-btn" onclick="toggleSound()" title="Sound">
                    <i class="fas fa-volume-up" id="soundIcon"></i>
                </button>
            </div>

            <!-- Mobile Controls -->
            <div class="mobile-controls" id="mobileControls">
                <button class="mobile-btn" id="leftBtn">‚óÄ</button>
                <button class="mobile-btn" id="rightBtn">‚ñ∂</button>
            </div>
        </div>

        <!-- Instructions -->
        <div class="game-instructions">
            <h3><i class="fas fa-gamepad"></i> How to Play</h3>

            <div class="instructions-grid">
                <div class="instruction-item">
                    <i class="fas fa-arrows-alt-h"></i>
                    <span>Use <strong>‚Üê ‚Üí</strong> or <strong>A/D</strong> to steer</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-car-crash"></i>
                    <span>Avoid crashing into other vehicles</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-coins"></i>
                    <span>Collect coins to increase your score</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-star"></i>
                    <span>Grab power-ups for special abilities</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Speed increases as you progress</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-heart"></i>
                    <span>You have 3 lives - don't lose them!</span>
                </div>
            </div>

            <div class="powerups-legend">
                <h4>‚ö° Power-ups</h4>
                <div class="powerup-list">
                    <div class="powerup-item">
                        <div class="icon" style="background: rgba(0, 255, 136, 0.3);">üõ°Ô∏è</div>
                        <span>Shield - Protects from one collision</span>
                    </div>
                    <div class="powerup-item">
                        <div class="icon" style="background: rgba(255, 215, 0, 0.3);">‚≠ê</div>
                        <span>2x Score - Double points for 5 seconds</span>
                    </div>
                    <div class="powerup-item">
                        <div class="icon" style="background: rgba(0, 212, 255, 0.3);">‚è±Ô∏è</div>
                        <span>Slow Mo - Slows down traffic</span>
                    </div>
                    <div class="powerup-item">
                        <div class="icon" style="background: rgba(255, 0, 128, 0.3);">üß≤</div>
                        <span>Magnet - Attracts nearby coins</span>
                    </div>
                    <div class="powerup-item">
                        <div class="icon" style="background: rgba(255, 107, 0, 0.3);">üí®</div>
                        <span>Nitro - Temporary speed boost + invincibility</span>
                    </div>
                    <div class="powerup-item">
                        <div class="icon" style="background: rgba(255, 0, 0, 0.3);">‚ù§Ô∏è</div>
                        <span>Extra Life - Adds one heart</span>
                    </div>
                </div>
            </div>

            <div class="tips-section">
                <h4>üí° Pro Tips</h4>
                <ul>
                    <li><i class="fas fa-lightbulb"></i> Stay in the middle lanes for more maneuverability</li>
                    <li><i class="fas fa-lightbulb"></i> Watch the shadows to predict incoming cars</li>
                    <li><i class="fas fa-lightbulb"></i> Save your shield for emergencies</li>
                    <li><i class="fas fa-lightbulb"></i> Collect coins in combos for bonus points</li>
                    <li><i class="fas fa-lightbulb"></i> Use nitro to phase through traffic jams</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div class="game-footer">
            <p>¬© 2025 <a href="../index.html">GameZone</a>. All Rights Reserved.</p>
        </div>

    </main>

    <!-- Sound Toggle Button -->
    <button class="sound-toggle" onclick="toggleSound()" title="Toggle Sound">
        <i class="fas fa-volume-up" id="soundToggleIcon"></i>
    </button>

    <script>
        // ==================== GAME VARIABLES ====================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let gameRunning = false;
        let gamePaused = false;
        let animationId;
        let soundEnabled = true;
        let audioContext = null;

        // Game settings
        let difficulty = 'medium';
        let selectedCar = 0;

        // Game stats
        let score = 0;
        let distance = 0;
        let lives = 3;
        let maxSpeed = 0;
        let carsDodged = 0;
        let highScore = localStorage.getItem('racingHighScore') || 0;

        // Game speed
        let gameSpeed = 5;
        let baseSpeed = 5;
        let speedMultiplier = 1;

        // Lane settings
        const laneCount = 4;
        const laneWidth = canvas.width / laneCount;
        const roadMargin = 30;

        // Road decoration
        let roadLineOffset = 0;

        // Player car
        const player = {
            width: 50,
            height: 90,
            x: canvas.width / 2 - 25,
            y: canvas.height - 150,
            speed: 8,
            dx: 0,
            color: '#ff6b00',
            emoji: 'üöó',
            hasShield: false,
            shieldTime: 0,
            hasMagnet: false,
            magnetTime: 0,
            hasSlowMo: false,
            slowMoTime: 0,
            hasNitro: false,
            nitroTime: 0,
            scoreMultiplier: 1,
            multiplierTime: 0,
            invincible: false,
            invincibleTime: 0,
            lane: 1
        };

        // Car types for variety
        const carEmojis = ['üöó', 'üèéÔ∏è', 'üöô', 'üöï', 'üèçÔ∏è'];
        const carColors = ['#ff6b00', '#e74c3c', '#3498db', '#f1c40f', '#9b59b6'];
        const enemyCarEmojis = ['üöê', 'üöå', 'üöö', 'üöõ', 'üöú', 'üèéÔ∏è', 'üöì', 'üöë', 'üöí'];

        // Enemy cars
        let enemies = [];
        let enemySpawnTimer = 0;
        let enemySpawnRate = 60;

        // Coins
        let coins = [];
        let coinSpawnTimer = 0;

        // Power-ups
        let powerups = [];
        let powerupSpawnTimer = 0;
        const powerupTypes = ['shield', 'score2x', 'slowmo', 'magnet', 'nitro', 'life'];

        // Particles
        let particles = [];

        // Background elements
        let trees = [];
        let buildings = [];

        // Difficulty settings
        const difficultySettings = {
            easy: { spawnRate: 80, speedIncrease: 0.001, maxEnemies: 4, lives: 4 },
            medium: { spawnRate: 60, speedIncrease: 0.002, maxEnemies: 6, lives: 3 },
            hard: { spawnRate: 45, speedIncrease: 0.003, maxEnemies: 8, lives: 2 },
            insane: { spawnRate: 30, speedIncrease: 0.005, maxEnemies: 10, lives: 1 }
        };

        // Input state
        const keys = {
            ArrowLeft: false,
            ArrowRight: false,
            a: false,
            d: false
        };

        // Mobile touch state
        let mobileLeft = false;
        let mobileRight = false;

        // Combo system
        let coinCombo = 0;
        let comboTimer = 0;

        // ==================== INITIALIZATION ====================
        function init() {
            // Event listeners
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);

            // Initialize audio on first interaction
            document.addEventListener('click', initAudio, { once: true });
            document.addEventListener('touchstart', initAudio, { once: true });

            // Mobile controls
            setupMobileControls();

            // Detect touch device
            if ('ontouchstart' in window) {
                document.getElementById('mobileControls').style.display = 'flex';
            }

            // Initialize background elements
            initBackground();

            // Draw initial state
            drawStartScreen();
        }

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function initBackground() {
            // Create trees on both sides
            for (let i = 0; i < 10; i++) {
                trees.push({
                    x: Math.random() < 0.5 ? Math.random() * 20 : canvas.width - 20 - Math.random() * 20,
                    y: Math.random() * canvas.height,
                    size: 15 + Math.random() * 10
                });
            }
        }

        function setupMobileControls() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');

            leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); mobileLeft = true; });
            leftBtn.addEventListener('touchend', () => { mobileLeft = false; });
            leftBtn.addEventListener('mousedown', () => { mobileLeft = true; });
            leftBtn.addEventListener('mouseup', () => { mobileLeft = false; });
            leftBtn.addEventListener('mouseleave', () => { mobileLeft = false; });

            rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); mobileRight = true; });
            rightBtn.addEventListener('touchend', () => { mobileRight = false; });
            rightBtn.addEventListener('mousedown', () => { mobileRight = true; });
            rightBtn.addEventListener('mouseup', () => { mobileRight = false; });
            rightBtn.addEventListener('mouseleave', () => { mobileRight = false; });
        }

        function selectCar(index) {
            selectedCar = index;
            player.emoji = carEmojis[index];
            player.color = carColors[index];

            document.querySelectorAll('.car-option').forEach((option, i) => {
                option.classList.toggle('selected', i === index);
            });
        }

        function setDifficulty(level) {
            difficulty = level;
            document.querySelectorAll('.diff-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`.diff-btn.${level}`).classList.add('selected');
        }

        // ==================== GAME CONTROLS ====================
        function startGame() {
            document.getElementById('startOverlay').classList.add('hidden');
            resetGame();
            showCountdown();
        }

        function showCountdown() {
            const countdownOverlay = document.getElementById('countdownOverlay');
            const countdownText = document.getElementById('countdownText');
            countdownOverlay.classList.remove('hidden');

            let count = 3;
            countdownText.textContent = count;
            playSound('countdown');

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownText.textContent = count;
                    playSound('countdown');
                } else if (count === 0) {
                    countdownText.textContent = 'GO!';
                    playSound('start');
                } else {
                    clearInterval(countdownInterval);
                    countdownOverlay.classList.add('hidden');
                    gameRunning = true;
                    gamePaused = false;
                    gameLoop();
                }
            }, 800);
        }

        function resetGame() {
            const settings = difficultySettings[difficulty];

            score = 0;
            distance = 0;
            lives = settings.lives;
            maxSpeed = 0;
            carsDodged = 0;
            gameSpeed = baseSpeed;
            speedMultiplier = 1;
            coinCombo = 0;
            comboTimer = 0;

            // Reset player
            player.x = canvas.width / 2 - player.width / 2;
            player.y = canvas.height - 150;
            player.dx = 0;
            player.hasShield = false;
            player.shieldTime = 0;
            player.hasMagnet = false;
            player.magnetTime = 0;
            player.hasSlowMo = false;
            player.slowMoTime = 0;
            player.hasNitro = false;
            player.nitroTime = 0;
            player.scoreMultiplier = 1;
            player.multiplierTime = 0;
            player.invincible = false;
            player.invincibleTime = 0;
            player.emoji = carEmojis[selectedCar];
            player.color = carColors[selectedCar];

            // Clear arrays
            enemies = [];
            coins = [];
            powerups = [];
            particles = [];

            // Reset timers
            enemySpawnTimer = 0;
            coinSpawnTimer = 0;
            powerupSpawnTimer = 0;

            enemySpawnRate = settings.spawnRate;

            updateDisplay();
        }

        function restartGame() {
            hideAllOverlays();
            resetGame();
            showCountdown();
        }

        function togglePause() {
            if (!gameRunning) return;

            gamePaused = !gamePaused;

            if (gamePaused) {
                document.getElementById('pauseOverlay').classList.remove('hidden');
                document.getElementById('pauseIcon').className = 'fas fa-play';
            } else {
                document.getElementById('pauseOverlay').classList.add('hidden');
                document.getElementById('pauseIcon').className = 'fas fa-pause';
                gameLoop();
            }
        }

        function resumeGame() {
            gamePaused = false;
            document.getElementById('pauseOverlay').classList.add('hidden');
            document.getElementById('pauseIcon').className = 'fas fa-pause';
            gameLoop();
        }

        function showMenu() {
            hideAllOverlays();
            document.getElementById('startOverlay').classList.remove('hidden');
            gameRunning = false;
            drawStartScreen();
        }

        // ==================== INPUT HANDLING ====================
        function handleKeyDown(e) {
            if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') {
                keys.ArrowLeft = true;
            }
            if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') {
                keys.ArrowRight = true;
            }

            if (e.key === ' ' || e.key.toLowerCase() === 'p') {
                e.preventDefault();
                togglePause();
            }

            if (e.key === 'Escape') {
                if (gameRunning) togglePause();
            }
        }

        function handleKeyUp(e) {
            if (e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a') {
                keys.ArrowLeft = false;
            }
            if (e.key === 'ArrowRight' || e.key.toLowerCase() === 'd') {
                keys.ArrowRight = false;
            }
        }

        // ==================== GAME LOOP ====================
        function gameLoop() {
            if (!gameRunning || gamePaused) return;

            update();
            draw();

            animationId = requestAnimationFrame(gameLoop);
        }

        function update() {
            const settings = difficultySettings[difficulty];
            const actualSpeed = player.hasSlowMo ? gameSpeed * 0.5 : gameSpeed;

            // Update distance and score
            distance += actualSpeed * 0.1;
            score += Math.floor(actualSpeed * player.scoreMultiplier * 0.1);

            // Increase game speed over time
            gameSpeed = Math.min(baseSpeed + distance * settings.speedIncrease, 20);

            // Track max speed
            const currentSpeed = Math.floor(60 + gameSpeed * 10);
            if (currentSpeed > maxSpeed) maxSpeed = currentSpeed;

            // Update road lines
            roadLineOffset = (roadLineOffset + actualSpeed) % 40;

            // Update player
            updatePlayer();

            // Update enemies
            updateEnemies(actualSpeed);

            // Update coins
            updateCoins(actualSpeed);

            // Update power-ups
            updatePowerups(actualSpeed);

            // Update particles
            updateParticles();

            // Update power-up timers
            updatePowerupTimers();

            // Update combo timer
            if (comboTimer > 0) {
                comboTimer--;
                if (comboTimer === 0) coinCombo = 0;
            }

            // Spawn enemies
            enemySpawnTimer++;
            if (enemySpawnTimer >= enemySpawnRate && enemies.length < settings.maxEnemies) {
                spawnEnemy();
                enemySpawnTimer = 0;
                // Gradually increase spawn rate
                enemySpawnRate = Math.max(settings.spawnRate - Math.floor(distance / 100), 20);
            }

            // Spawn coins
            coinSpawnTimer++;
            if (coinSpawnTimer >= 40) {
                spawnCoin();
                coinSpawnTimer = 0;
            }

            // Spawn power-ups
            powerupSpawnTimer++;
            if (powerupSpawnTimer >= 300 && powerups.length < 2) {
                if (Math.random() < 0.3) {
                    spawnPowerup();
                }
                powerupSpawnTimer = 0;
            }

            // Update display
            updateDisplay();
        }

        function updatePlayer() {
            // Handle input
            let dx = 0;
            if (keys.ArrowLeft || mobileLeft) dx = -player.speed;
            if (keys.ArrowRight || mobileRight) dx = player.speed;

            player.x += dx;

            // Boundaries (keep on road)
            if (player.x < roadMargin) player.x = roadMargin;
            if (player.x + player.width > canvas.width - roadMargin) {
                player.x = canvas.width - roadMargin - player.width;
            }

            // Update invincibility
            if (player.invincible && player.invincibleTime > 0) {
                player.invincibleTime--;
                if (player.invincibleTime === 0) {
                    player.invincible = false;
                }
            }
        }

        function updateEnemies(speed) {
            enemies = enemies.filter(enemy => {
                enemy.y += speed + enemy.speedOffset;

                // Check collision with player
                if (checkCollision(player, enemy)) {
                    if (player.hasNitro) {
                        // Destroy enemy with nitro
                        createExplosion(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
                        playSound('explosion');
                        score += 100;
                        return false;
                    } else if (player.hasShield) {
                        // Use shield
                        player.hasShield = false;
                        player.shieldTime = 0;
                        updatePowerupIndicators();
                        createShieldBreak(player.x + player.width / 2, player.y);
                        playSound('shieldBreak');
                        player.invincible = true;
                        player.invincibleTime = 60;
                        return false;
                    } else if (!player.invincible) {
                        // Take damage
                        handleCollision();
                        return false;
                    }
                }

                // Remove if off screen
                if (enemy.y > canvas.height + 100) {
                    carsDodged++;
                    score += 10;
                    return false;
                }

                return true;
            });
        }

        function updateCoins(speed) {
            coins = coins.filter(coin => {
                coin.y += speed;
                coin.rotation += 0.1;

                // Magnet effect
                if (player.hasMagnet) {
                    const dx = (player.x + player.width / 2) - coin.x;
                    const dy = (player.y + player.height / 2) - coin.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 150) {
                        coin.x += dx * 0.1;
                        coin.y += dy * 0.1;
                    }
                }

                // Check collection
                const coinRect = { x: coin.x - 15, y: coin.y - 15, width: 30, height: 30 };
                if (checkCollision(player, coinRect)) {
                    collectCoin(coin);
                    return false;
                }

                return coin.y < canvas.height + 20;
            });
        }

        function updatePowerups(speed) {
            powerups = powerups.filter(powerup => {
                powerup.y += speed;
                powerup.pulse = (powerup.pulse || 0) + 0.1;

                // Check collection
                const powerupRect = { x: powerup.x - 20, y: powerup.y - 20, width: 40, height: 40 };
                if (checkCollision(player, powerupRect)) {
                    applyPowerup(powerup.type);
                    createPowerupParticles(powerup.x, powerup.y);
                    playSound('powerup');
                    return false;
                }

                return powerup.y < canvas.height + 30;
            });
        }

        function updatePowerupTimers() {
            if (player.shieldTime > 0) {
                player.shieldTime--;
                if (player.shieldTime === 0) player.hasShield = false;
            }

            if (player.magnetTime > 0) {
                player.magnetTime--;
                if (player.magnetTime === 0) player.hasMagnet = false;
            }

            if (player.slowMoTime > 0) {
                player.slowMoTime--;
                if (player.slowMoTime === 0) player.hasSlowMo = false;
            }

            if (player.nitroTime > 0) {
                player.nitroTime--;
                if (player.nitroTime === 0) player.hasNitro = false;
                // Nitro particles
                if (player.hasNitro) {
                    createNitroParticles();
                }
            }

            if (player.multiplierTime > 0) {
                player.multiplierTime--;
                if (player.multiplierTime === 0) player.scoreMultiplier = 1;
            }

            updatePowerupIndicators();
        }

        function updateParticles() {
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.02;
                if (p.gravity) p.vy += 0.2;
                return p.life > 0;
            });
        }

        // ==================== SPAWNING ====================
        function spawnEnemy() {
            const lane = Math.floor(Math.random() * laneCount);
            const x = roadMargin + lane * laneWidth + (laneWidth - 50) / 2;

            enemies.push({
                x: x,
                y: -100,
                width: 50,
                height: 90,
                speedOffset: Math.random() * 2 - 1,
                emoji: enemyCarEmojis[Math.floor(Math.random() * enemyCarEmojis.length)],
                color: ['#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#f39c12'][Math.floor(Math.random() * 5)]
            });
        }

        function spawnCoin() {
            const lane = Math.floor(Math.random() * laneCount);
            const x = roadMargin + lane * laneWidth + laneWidth / 2;

            // Don't spawn on enemies
            const blocked = enemies.some(e =>
                Math.abs(e.x + e.width / 2 - x) < 40 && e.y < 100
            );

            if (!blocked) {
                coins.push({
                    x: x,
                    y: -20,
                    value: Math.random() < 0.1 ? 50 : 10,
                    rotation: 0
                });
            }
        }

        function spawnPowerup() {
            const lane = Math.floor(Math.random() * laneCount);
            const x = roadMargin + lane * laneWidth + laneWidth / 2;
            const type = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];

            powerups.push({
                x: x,
                y: -30,
                type: type,
                pulse: 0
            });
        }

        // ==================== COLLISION & EFFECTS ====================
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.height &&
                rect1.y + rect1.height > rect2.y;
        }

        function handleCollision() {
            lives--;
            playSound('crash');
            createExplosion(player.x + player.width / 2, player.y + player.height / 2);

            // Screen shake effect
            canvas.style.animation = 'shake 0.3s ease';
            setTimeout(() => canvas.style.animation = '', 300);

            // Brief invincibility
            player.invincible = true;
            player.invincibleTime = 90;

            if (lives <= 0) {
                handleGameOver();
            } else {
                updateDisplay();
            }
        }

        function handleGameOver() {
            gameRunning = false;

            // Update high score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('racingHighScore', highScore);
            }

            // Update game over display
            document.getElementById('finalScore').textContent = score.toLocaleString();
            document.getElementById('finalDistance').textContent = Math.floor(distance) + 'm';
            document.getElementById('finalMaxSpeed').textContent = maxSpeed + ' km/h';
            document.getElementById('finalCarsDodged').textContent = carsDodged;

            const highScoreEl = document.getElementById('highScoreDisplay');
            highScoreEl.textContent = highScore.toLocaleString();
            if (score >= highScore) {
                highScoreEl.classList.add('new-record');
            } else {
                highScoreEl.classList.remove('new-record');
            }

            document.getElementById('gameOverOverlay').classList.remove('hidden');
            playSound('gameOver');
        }

        function collectCoin(coin) {
            coinCombo++;
            comboTimer = 60;

            const bonus = Math.min(coinCombo, 10);
            const value = coin.value * player.scoreMultiplier * bonus;
            score += value;

            createCoinParticles(coin.x, coin.y);
            playSound('coin');

            // Show combo text
            if (coinCombo > 1) {
                showFloatingText(`x${coinCombo}`, coin.x, coin.y, '#ffd700');
            }
        }

        function applyPowerup(type) {
            switch (type) {
                case 'shield':
                    player.hasShield = true;
                    player.shieldTime = 600; // 10 seconds
                    break;
                case 'score2x':
                    player.scoreMultiplier = 2;
                    player.multiplierTime = 300; // 5 seconds
                    break;
                case 'slowmo':
                    player.hasSlowMo = true;
                    player.slowMoTime = 300; // 5 seconds
                    break;
                case 'magnet':
                    player.hasMagnet = true;
                    player.magnetTime = 300; // 5 seconds
                    break;
                case 'nitro':
                    player.hasNitro = true;
                    player.nitroTime = 180; // 3 seconds
                    break;
                case 'life':
                    lives = Math.min(lives + 1, 5);
                    break;
            }

            showFloatingText(getPowerupName(type), player.x + player.width / 2, player.y, '#00ff88');
        }

        function getPowerupName(type) {
            const names = {
                shield: 'üõ°Ô∏è SHIELD!',
                score2x: '‚≠ê 2X SCORE!',
                slowmo: '‚è±Ô∏è SLOW MO!',
                magnet: 'üß≤ MAGNET!',
                nitro: 'üí® NITRO!',
                life: '‚ù§Ô∏è +1 LIFE!'
            };
            return names[type] || type;
        }

        function getPowerupIcon(type) {
            const icons = { shield: 'üõ°Ô∏è', score2x: '‚≠ê', slowmo: '‚è±Ô∏è', magnet: 'üß≤', nitro: 'üí®', life: '‚ù§Ô∏è' };
            return icons[type] || '‚ö°';
        }

        // ==================== PARTICLES ====================
        function createExplosion(x, y) {
            for (let i = 0; i < 30; i++) {
                const angle = (Math.PI * 2 * i) / 30;
                const speed = 3 + Math.random() * 5;
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    color: ['#ff6b00', '#ff0080', '#ffd700', '#fff'][Math.floor(Math.random() * 4)],
                    size: 3 + Math.random() * 5,
                    life: 1,
                    gravity: true
                });
            }
        }

        function createShieldBreak(x, y) {
            for (let i = 0; i < 20; i++) {
                const angle = (Math.PI * 2 * i) / 20;
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * 4,
                    vy: Math.sin(angle) * 4,
                    color: '#00d4ff',
                    size: 4,
                    life: 1,
                    gravity: false
                });
            }
        }

        function createCoinParticles(x, y) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 4,
                    vy: -Math.random() * 4 - 2,
                    color: '#ffd700',
                    size: 3,
                    life: 0.8,
                    gravity: true
                });
            }
        }

        function createPowerupParticles(x, y) {
            for (let i = 0; i < 15; i++) {
                const angle = (Math.PI * 2 * i) / 15;
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * 3,
                    vy: Math.sin(angle) * 3,
                    color: '#ff0080',
                    size: 4,
                    life: 1,
                    gravity: false
                });
            }
        }

        function createNitroParticles() {
            particles.push({
                x: player.x + player.width / 2 + (Math.random() - 0.5) * 20,
                y: player.y + player.height,
                vx: (Math.random() - 0.5) * 2,
                vy: 5 + Math.random() * 3,
                color: ['#ff6b00', '#ffd700', '#ff0080'][Math.floor(Math.random() * 3)],
                size: 5 + Math.random() * 5,
                life: 0.5,
                gravity: false
            });
        }

        let floatingTexts = [];
        function showFloatingText(text, x, y, color) {
            floatingTexts.push({ text, x, y, color, life: 1 });
        }

        // ==================== DRAWING ====================
        function draw() {
            // Clear canvas
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw road
            drawRoad();

            // Draw particles (behind everything)
            drawParticles();

            // Draw coins
            drawCoins();

            // Draw power-ups
            drawPowerups();

            // Draw enemies
            drawEnemies();

            // Draw player
            drawPlayer();

            // Draw floating texts
            drawFloatingTexts();

            // Draw combo display
            if (coinCombo > 1) {
                drawCombo();
            }
        }

        function drawStartScreen() {
            ctx.fillStyle = '#1a1a2e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            drawRoad();
            drawPlayer();
        }

        function drawRoad() {
            // Road background
            ctx.fillStyle = '#2d2d44';
            ctx.fillRect(roadMargin, 0, canvas.width - roadMargin * 2, canvas.height);

            // Road edges
            ctx.fillStyle = '#ff6b00';
            ctx.fillRect(roadMargin - 5, 0, 5, canvas.height);
            ctx.fillRect(canvas.width - roadMargin, 0, 5, canvas.height);

            // Lane dividers (dashed)
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.setLineDash([20, 20]);

            for (let i = 1; i < laneCount; i++) {
                const x = roadMargin + i * laneWidth;
                ctx.beginPath();
                ctx.moveTo(x, -roadLineOffset);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            ctx.setLineDash([]);

            // Grass/sides
            ctx.fillStyle = '#1a472a';
            ctx.fillRect(0, 0, roadMargin - 5, canvas.height);
            ctx.fillRect(canvas.width - roadMargin + 5, 0, roadMargin - 5, canvas.height);

            // Trees on sides
            trees.forEach(tree => {
                tree.y = (tree.y + gameSpeed * 0.3) % (canvas.height + 30);
                ctx.font = `${tree.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText('üå≤', tree.x, tree.y);
            });
        }

        function drawPlayer() {
            ctx.save();

            // Invincibility flash
            if (player.invincible && Math.floor(Date.now() / 100) % 2 === 0) {
                ctx.globalAlpha = 0.5;
            }

            // Draw car shadow
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.ellipse(
                player.x + player.width / 2 + 5,
                player.y + player.height - 5,
                player.width / 2,
                10,
                0, 0, Math.PI * 2
            );
            ctx.fill();

            // Draw car emoji
            ctx.font = '60px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(player.emoji, player.x + player.width / 2, player.y + player.height / 2);

            // Draw shield effect
            if (player.hasShield) {
                ctx.strokeStyle = '#00d4ff';
                ctx.lineWidth = 3;
                ctx.shadowColor = '#00d4ff';
                ctx.shadowBlur = 15;
                ctx.beginPath();
                ctx.arc(
                    player.x + player.width / 2,
                    player.y + player.height / 2,
                    50,
                    0, Math.PI * 2
                );
                ctx.stroke();
                ctx.shadowBlur = 0;
            }

            // Draw nitro effect
            if (player.hasNitro) {
                ctx.fillStyle = '#ff6b00';
                ctx.shadowColor = '#ff6b00';
                ctx.shadowBlur = 20;
                ctx.font = '30px Arial';
                ctx.fillText('üí®', player.x + player.width / 2, player.y + player.height + 20);
                ctx.shadowBlur = 0;
            }

            ctx.restore();
        }

        function drawEnemies() {
            enemies.forEach(enemy => {
                // Shadow
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.beginPath();
                ctx.ellipse(
                    enemy.x + enemy.width / 2 + 5,
                    enemy.y + enemy.height - 5,
                    enemy.width / 2,
                    10,
                    0, 0, Math.PI * 2
                );
                ctx.fill();

                // Car emoji
                ctx.font = '60px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(enemy.emoji, enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
            });
        }

        function drawCoins() {
            coins.forEach(coin => {
                ctx.save();
                ctx.translate(coin.x, coin.y);
                ctx.rotate(coin.rotation);

                // Coin glow
                ctx.shadowColor = '#ffd700';
                ctx.shadowBlur = 10;

                ctx.font = coin.value > 10 ? '28px Arial' : '22px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(coin.value > 10 ? 'üíé' : 'ü™ô', 0, 0);

                ctx.restore();
            });
        }

        function drawPowerups() {
            powerups.forEach(powerup => {
                const pulse = Math.sin(powerup.pulse) * 3;

                ctx.shadowColor = '#ff0080';
                ctx.shadowBlur = 15 + pulse;

                ctx.font = '35px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(getPowerupIcon(powerup.type), powerup.x, powerup.y);

                ctx.shadowBlur = 0;
            });
        }

        function drawParticles() {
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
        }

        function drawFloatingTexts() {
            floatingTexts = floatingTexts.filter(ft => {
                ft.y -= 2;
                ft.life -= 0.02;

                ctx.globalAlpha = ft.life;
                ctx.font = 'bold 16px Poppins';
                ctx.textAlign = 'center';
                ctx.fillStyle = ft.color;
                ctx.fillText(ft.text, ft.x, ft.y);

                return ft.life > 0;
            });
            ctx.globalAlpha = 1;
        }

        function drawCombo() {
            ctx.font = 'bold 24px "Press Start 2P"';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#ffd700';
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 10;
            ctx.fillText(`COMBO x${coinCombo}`, canvas.width / 2, 50);
            ctx.shadowBlur = 0;
        }

        // ==================== UI UPDATES ====================
        function updateDisplay() {
            document.getElementById('scoreDisplay').textContent = score.toLocaleString();
            document.getElementById('speedDisplay').textContent = Math.floor(60 + gameSpeed * 10);
            document.getElementById('distanceDisplay').textContent = Math.floor(distance);

            // Lives display
            let livesHTML = '';
            for (let i = 0; i < lives; i++) livesHTML += '‚ù§Ô∏è';
            for (let i = lives; i < 3; i++) livesHTML += 'üñ§';
            document.getElementById('livesDisplay').textContent = livesHTML;
        }

        function updatePowerupIndicators() {
            const shieldIndicator = document.getElementById('shieldIndicator');
            const magnetIndicator = document.getElementById('magnetIndicator');
            const slowmoIndicator = document.getElementById('slowmoIndicator');

            if (player.hasShield && player.shieldTime > 0) {
                shieldIndicator.classList.add('active');
                document.getElementById('shieldTime').textContent = Math.ceil(player.shieldTime / 60) + 's';
            } else {
                shieldIndicator.classList.remove('active');
            }

            if (player.hasMagnet && player.magnetTime > 0) {
                magnetIndicator.classList.add('active');
                document.getElementById('magnetTime').textContent = Math.ceil(player.magnetTime / 60) + 's';
            } else {
                magnetIndicator.classList.remove('active');
            }

            if (player.hasSlowMo && player.slowMoTime > 0) {
                slowmoIndicator.classList.add('active');
                document.getElementById('slowmoTime').textContent = Math.ceil(player.slowMoTime / 60) + 's';
            } else {
                slowmoIndicator.classList.remove('active');
            }
        }

        function hideAllOverlays() {
            document.querySelectorAll('.game-overlay').forEach(overlay => {
                overlay.classList.add('hidden');
            });
        }

        // ==================== SOUND ====================
        function playSound(type) {
            if (!soundEnabled || !audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            switch (type) {
                case 'coin':
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;

                case 'crash':
                    oscillator.frequency.value = 100;
                    oscillator.type = 'sawtooth';
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.3);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;

                case 'powerup':
                    const notes = [523, 659, 784, 1047];
                    notes.forEach((freq, i) => {
                        setTimeout(() => {
                            if (!soundEnabled) return;
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            osc.frequency.value = freq;
                            osc.type = 'sine';
                            gain.gain.setValueAtTime(0.08, audioContext.currentTime);
                            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                            osc.start();
                            osc.stop(audioContext.currentTime + 0.15);
                        }, i * 60);
                    });
                    return;

                case 'explosion':
                    oscillator.frequency.value = 150;
                    oscillator.type = 'square';
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(30, audioContext.currentTime + 0.2);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;

                case 'shieldBreak':
                    oscillator.frequency.value = 500;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.2);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;

                case 'countdown':
                    oscillator.frequency.value = 440;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;

                case 'start':
                    oscillator.frequency.value = 880;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;

                case 'gameOver':
                    const goNotes = [400, 350, 300, 250];
                    goNotes.forEach((freq, i) => {
                        setTimeout(() => {
                            if (!soundEnabled) return;
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            osc.frequency.value = freq;
                            osc.type = 'sine';
                            gain.gain.setValueAtTime(0.12, audioContext.currentTime);
                            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                            osc.start();
                            osc.stop(audioContext.currentTime + 0.3);
                        }, i * 200);
                    });
                    return;
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const icons = [document.getElementById('soundIcon'), document.getElementById('soundToggleIcon')];

            icons.forEach(icon => {
                if (icon) {
                    icon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
                }
            });
        }

        function toggleMenu() {
            // Mobile menu toggle
        }

        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);

        // ==================== START ====================
        init();
    </script>

</body>

</html>

